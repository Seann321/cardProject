<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Garbage</title>
</head>
<body>
    <script>
        let cardDivArray = []
        let playerHandArray
        init()


        async function init(){
            await fetchNewData('/initGarbage/', false).then((data) => playerHandArray = (data['playerHand']))
            let i = 0;
            // Creates the 'cards'
            playerHandArray.forEach((element) => {
              let cardDiv = document.createElement("div");
              document.body.appendChild(cardDiv);
              cardDiv.innerHTML = innerHTMLData(i);
              i++
                cardDivArray.push(cardDiv);
            });
        }

        // Returns JSON Data and updates text when card is clicked. Update decides to return object, or update text
        async function fetchNewData(data, update=true) {
            let obj
            let cardData
            const res = fetch(data);
            obj = (await res).json();
            await obj.then(data => cardData = data.valueOf())
            if(!update){
                return cardData
            }
            updateText(cardData)
        }

        // Goes through and updates all screen text with the given object
        function updateText(cardData){
            let cardDisplayDiv = document.getElementById('currentCardDisplay')
            cardDisplayDiv.textContent = 'Your current card is ' + cardData['currentCard']
            playerHandArray = cardData['playerHand']
            if(cardData['gameOver'])
                console.log('Game Over!')
            let i = 0
            cardDivArray.forEach((element) => {
                if(playerHandArray[i] != null){
                element.innerHTML = innerHTMLData(i);
                i++;
        }else{
                    // Sets the cards no longer being used to nothing
                    element.innerHTML = '';
                }});
        }

        // Inner HTML for each of the cards
        function innerHTMLData(i){
            return '<div class=playingCard onclick="fetchNewData(`/garbageCardData/${JSON.stringify(' + i + ')}`)">  <div class="top">' +
                playerHandArray[i].charAt(0) +
                '</div><div class = "text">' +
                playerHandArray[i].substring(1) +
                '</div> <div class = "bottom">' +
                playerHandArray[i].charAt(0) +
                "</div></div>";
        }


    </script>
    <a href="/return/">Return to home</a>
    <a href="/garbageReset/">Reset</a>
    <a onclick="fetchNewData('/garbageDeckPull/')">Pull From Deck</a>
    <a onclick="fetchNewData('/garbageDeckPull/')">Discard Card</a>
    <div id="currentCardDisplay">Your current card is {{currentCard}}</div>
</body>
</html>